# This is a Spack Environment file.
#
# It describes a set of packages to be installed, along with
# configuration settings.
spack:
  view: false
  concretizer:
    unify: false

  compilers:
  - compiler:
      spec: gcc@=11.5.0
      operating_system: rocky9
      target: x86_64
      paths:
        cc: /scinet/spack/compilers/core-gcc-11.5.0/bin/core-gcc
        cxx: /scinet/spack/compilers/core-gcc-11.5.0/bin/core-g++
        f77: /scinet/spack/compilers/core-gcc-11.5.0/bin/core-gfortran
        fc: /scinet/spack/compilers/core-gcc-11.5.0/bin/core-gfortran
      extra_rpaths:
      - /scinet/spack/compilers/core-gcc-11.5.0/lib64
      modules: []

  packages:
    amd-aocl:
      require: +openmp
    amdblis:
      require: threads=openmp
    amdlibflame:
      require: threads=openmp
    amdfftw:
      require: +openmp
    aocc:
      variants: +license-agreed
    fftw:
      variants: +openmp
    hdf5:
      variants: +cxx +fortran +hl +szip
    hpl:
      require: +openmp
    mvapich:
      variants: netmod=ucx process_managers=slurm
    mvapich-plus:
      variants: netmod=ucx process_managers=slurm
    openblas:
      variants: threads=openmp
    openmpi:
      require: fabrics=cma,hcoll,ucc,ucx +openshmem schedulers=slurm
    wrf:
      variants: build_type=dm+sm

    # hpcx
    # https://github.com/spack/spack/issues/49892
    hcoll:
      buildable: false
      externals:
      - spec: hcoll@4.8.3230
        prefix: /scinet/nvidia/hpcx/v2.21-LTS/hcoll
    ucc:
      buildable: false
      externals:
      - spec: ucc@1.4.0
        prefix: /scinet/nvidia/hpcx/v2.21-LTS/ucc
    ucx:
      require: "@1.18 +cma +dc +dm +ib_hw_tm +knem +mlx5_dv +parameter_checking +rc +rdmacm +ud +verbs"
    knem:
      buildable: false
      externals:
      - spec: knem@1.1.4
        prefix: /opt/knem-1.1.4.90mlnx3
    rdma-core:
      buildable: false
      externals:
      - spec: rdma-core@54.0
        prefix: /usr

  modules:
    default:
      arch_folder: false
      'enable:':
      - lmod
      roots:
        lmod: modules
      lmod:
        core_compilers:
        - gcc@11.5.0
        exclude:
        - lmod
        hash_length: 0
        hide_implicits: true
        hierarchy:
        - mpi
        - lapack
        projections:
          all: '{name}/{version}'
        all:
          autoload: direct
          environment:
            set:
              MODULE_{name}_ROOT: '{prefix}'

  specs:
  - cmake
  - lmod
  - ninja

